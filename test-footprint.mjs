import { parseEasyEDAFootprint, convertToKiCadFootprint } from './lib/kicad-parser.ts';
import fs from 'fs';

// C25804 footprint data from API
const footprintStr = {"head":{"docType":"4","editorVersion":"6.5.43","c_para":{"package":"R0603","pre":"R?","Contributor":"lcsc","3DModel":"R0603","link":"https://www.mouser.in/datasheet/2/447/PYu_RT_1_to_0_01_RoHS_L_11-1669912.pdf"},"hasIdFlag":true,"x":4000,"y":3000,"utime":1720420731,"uuid":"398691f1f785460098bbe5ee6590333c","importFlag":0,"transformList":"","newgId":true,"uuid_3d":"e06b23482b894f1ebafac2e1696a59f5"},"canvas":"CA~1000~1000~#000000~yes~#FFFFFF~10~1000~1000~line~0.03937~mm~1~45~visible~0.5~4000~3000~0~none","shape":["CIRCLE~3996.85~3001.575~0.118~0.2362~101~gge1043~0~~","SOLIDREGION~100~~M 3996.8504 3001.5748 L 3996.8504 2998.4252 L 3998.0315 2998.4252 L 3998.0315 3001.5748 Z ~solid~gge1000~~~~0","SOLIDREGION~100~~M 4003.1496 3001.5748 L 4003.1496 2998.4252 L 4001.9685 2998.4252 L 4001.9685 3001.5748 Z ~solid~gge1001~~~~0","SOLIDREGION~99~~M 3996.8504 3001.5748 L 3996.8504 2998.4252 L 4003.1496 2998.4252 L 4003.1496 3001.5748 Z ~solid~gge999~~~~0","SOLIDREGION~5~~M 4004.7048 2998.2284 L 4001.5552 2998.2284 L 4001.3583 2998.4253 L 4001.3583 2999.3228 L 4002.815 2999.3228 L 4002.815 3000.622 L 4001.3583 3000.622 L 4001.3583 3001.5749 L 4001.5552 3001.7717 L 4004.7048 3001.7717 L 4004.9016 3001.5749 L 4004.9016 2998.4253 Z ~solid~gge1030~~~~0","SOLIDREGION~5~~M 3995.2952 3001.7716 L 3998.4448 3001.7716 L 3998.6417 3001.5747 L 3998.6417 3000.6772 L 3997.185 3000.6772 L 3997.185 2999.378 L 3998.6417 2999.378 L 3998.6417 2998.4251 L 3998.4448 2998.2283 L 3995.2952 2998.2283 L 3995.0984 2998.4251 L 3995.0984 3001.5747 Z~solid~gge1050~~~~0","PAD~RECT~4002.966~3000~3.1751~3.4016~1~~2~0~4001.378 3001.7008 4001.378 2998.2992 4004.5531 2998.2992 4004.5531 3001.7008~0~gge1002~0~~Y~0~-393.7008~0.2000~4002.9655,3000","PAD~RECT~3997.034~3000~3.1751~3.4016~1~~1~0~3998.622 3001.7008 3998.622 2998.2992 3995.4469 2998.2992 3995.4469 3001.7008~0~gge1004~0~~Y~0~-393.7008~0.2000~3997.0345,3000","TRACK~0.6~3~~4001.678 3002.6008 4005.4531 3002.6008 4005.4531 2997.3992 4001.678 2997.3992~gge1006~0","TRACK~0.6~3~~3998.322 3002.6008 3994.5469 3002.6008 3994.5469 2997.3992 3998.322 2997.3992~gge1007~0","SVGNODE~{\"gId\":\"g1_outline\",\"nodeName\":\"g\",\"nodeType\":1,\"layerid\":\"19\",\"attrs\":{\"c_width\":\"3.18897\",\"c_height\":\"6.37794\",\"c_rotation\":\"0,0,90\",\"z\":\"0\",\"c_origin\":\"4000,3000\",\"uuid\":\"6bd5cd867e9542ebae21caaf5d2d4c4d\",\"c_etype\":\"outline3D\",\"id\":\"g1_outline\",\"title\":\"R0603\",\"layerid\":\"19\",\"transform\":\"scale(1) translate(0, 0)\"},\"childNodes\":[{\"gId\":\"g1_outline_line0\",\"nodeName\":\"polyline\",\"nodeType\":1,\"attrs\":{\"fill\":\"none\",\"id\":\"g1_outline_line0\",\"c_shapetype\":\"line\",\"points\":\"3997.0856 3001.5945 3997.0859 3001.5945 3997.0923 3001.5945 3997.0948 3001.5945 3997.1114 3001.5945 3997.1159 3001.5945 3997.1414 3001.5945 3997.1481 3001.5945 3997.157 3001.5945 3997.1695 3001.5945 3997.1711 3001.5945 3997.1733 3001.5945 3997.1803 3001.5945 3997.1829 3001.5945 3997.1848 3001.5945 3997.1963 3001.5945 3997.1991 3001.5945 3997.203 3001.5945 3997.2202 3001.5945 3997.2262 3001.5945 3997.2307 3001.5945 3997.2476 3001.5945 3997.2482 3001.5945 3997.2492 3001.5945 3997.2559 3001.5945 3997.261 3001.5945 3997.2639 3001.5945 3997.2808 3001.5945 3997.2859 3001.5945 3997.2887 3001.5945 3997.3009 3001.5945 3997.3021 3001.5945 3997.3066 3001.5945 3997.313 3001.5945 3997.3162 3001.5945 3997.3209 3001.5945 3997.3213 3001.5945 3997.3238 3001.5945 3997.3251 3001.5945 3997.3292 3001.5945 3997.3315 3001.5945 3997.3331 3001.5945 3997.3372 3001.5945 3997.3378 3001.5945 3997.3423 3001.5945 3997.3484 3001.5945 3997.3586 3001.5945 3997.3602 3001.5945 3997.3605 3001.5945 3997.3627 3001.5945 3997.3688 3001.5945 3997.3726 3001.5945 3997.3739 3001.5945 3997.3815 3001.5945 3997.3854 3001.5945 3997.3898 3001.5945 3997.3901 3001.5945 3997.394 3001.5945 3997.3968 3001.5945 3997.4051 3001.5945 3997.4061 3001.5945 3997.407 3001.5945 3997.4141 3001.5945 3997.4157 3001.5945 3997.4182 3001.5945 3997.4201 3001.5945 3997.4214 3001.5945 3997.422 3001.5945 3997.4224 3001.5945 3997.4236 3001.5945 3997.4243 3001.5945 3997.4357 3001.5945 3997.4504 3001.5945 3997.4546 3001.5945 3997.4622 3001.5945 3997.4737 3001.5945 3997.4826 3001.5945 3997.4833 3001.5945 3997.4976 3001.5945 3997.4983 3001.5945 3997.5062 3001.5945 3997.5069 3001.5945 3997.5416 3001.5945 3997.5493 3001.5945 3997.5506 3001.5945 3997.5904 3001.5945 3997.6041 3001.5945 3997.6322 3001.5945 3997.6462 3001.5945 3997.6465 3001.5945 3997.6472 3001.5945 3997.6488 3001.5945 3997.6507 3001.5945 3997.6516 3001.5945 3997.6539 3001.5945 3997.6561 3001.5945 3997.6609 3001.5945 3997.6625 3001.5945 3997.6692 3001.5945 3997.6701 3001.5945 3997.6708 3001.5945 3997.6714 3001.5945 3997.6784 3001.5945 3997.6803 3001.5945 3997.6848 3001.5945 3997.6874 3001.5945 3997.6886 3001.5945 3997.6899 3001.5945 3997.6928 3001.5945 3997.6953 3001.5945 3997.7167 3001.5945 3997.7301 3001.5945 3997.7333 3001.5945 3997.7365 3001.5945 3997.7473 3001.5945 3997.7553 3001.5945 3997.7633 3001.5945 3997.7725 3001.5945 3997.7735 3001.5945 3997.7789 3001.5945 3997.7955 3001.5945 3997.8015 3001.5945 3997.8022 3001.5945 3997.8025 3001.5945 3997.8127 3001.5945 3997.8162 3001.5945 3997.8219 3001.5945 3997.8238 3001.5945 3997.8318 3001.5945 3997.8385 3001.5945 3997.8433 3001.5945 3997.8439 3001.5945 3997.8478 3001.5945 3997.8503 3001.5945 3997.851 3001.5945 3997.8519 3001.5945 3997.8787 3001.5945 3997.8841 3001.5945 3997.887 3001.5945 3997.9077 3001.5945 3997.9131 3001.5945 3997.9256 3001.5945 3997.9281 3001.5945 3997.9329 3001.5945 3997.9332 3001.5945 3997.9332 3001.5549 3998.0098 3001.5549 3998.0863 3001.5549 3998.0863 3001.5945 3998.1102 3001.5945 3998.1772 3001.5945 3998.1823 3001.5945 3998.1848 3001.5945 3998.1868 3001.5945 3998.1868 3001.5549 3998.1896 3001.5549 3998.1925 3001.5549 3998.1928 3001.5945 3998.1954 3001.5945 3998.197 3001.5945 3998.2027 3001.5945 3998.2059 3001.5945 3998.2091 3001.5945 3998.21 3001.5945 3998.2107 3001.5945 3998.2132 3001.5945 3998.2139 3001.5945 3998.2164 3001.5945 3998.217 3001.5945 3998.218 3001.5945 3998.2186 3001.5945 3998.2193 3001.5945 3998.2206 3001.5945 3998.2209 3001.5945 3998.2221 3001.5945 3998.2237 3001.5945 3998.2257 3001.5945 3998.2263 3001.5945 3998.2269 3001.5945 3998.2276 3001.5945 3998.2314 3001.5945 3998.233 3001.5945 3998.2333 3001.5945 3998.2343 3001.5945 3998.2349 3001.5945 3998.2359 3001.5945 3998.2365 3001.5945 3998.2375 3001.5945 3998.2384 3001.5945 3998.2391 3001.5945 3998.2397 3001.5945 3998.2413 3001.5945 3998.2422 3001.5945 3998.2442 3001.5945 3998.2477 3001.5945 3998.2489 3001.5945 3998.2499 3001.5945 3998.2518 3001.5945 3998.2534 3001.5945 3998.2575 3001.5945 3998.2607 3001.5945 3998.2617 3001.5945 3998.2642 3001.5945 3998.2649 3001.5945 3998.2652 3001.5945 3998.2658 3001.5945 3998.2665 3001.5945 3998.2681 3001.5945 3998.2693 3001.5945 3998.2738 3001.5945 3998.2748 3001.5945 3998.2792 3001.5945 3998.2802 3001.5945 3998.2805 3001.5945 3998.2811 3001.5945 3998.2818 3001.5945 3998.2827 3001.5945 3998.284 3001.5945 3998.2872 3001.5945 3998.2882 3001.5945 3998.2885 3001.5945 3998.2901 3001.5945 3998.2913 3001.5945 3998.2923 3001.5945 3998.2929 3001.5945 3998.2996 3001.5945 3998.306 3001.5945 3998.3089 3001.5945 3998.3111 3001.5945 3998.3127 3001.5945 3998.314 3001.5945 3998.3143 3001.5945 3998.3162 3001.5945 3998.329 3001.5945 3998.3303 3001.5945 3998.3322 3001.5945 3998.3322 3001.5549 3998.3481 3001.5549 3998.3481 3001.5945 3998.3491 3001.5945 3998.3519 3001.5945 3998.3548 3001.5945 3998.3561 3001.5945 3998.3564 3001.5945 3998.3586 3001.5945 3998.3631 3001.5945 3998.3644 3001.5945 3998.3688 3001.5945 3998.3695 3001.5945 3998.3711 3001.5945 3998.3727 3001.5945 3998.3733 3001.5945 3998.3739 3001.5945 3998.3752 3001.5945 3998.3759 3001.5945 3998.3775 3001.5945 3998.3794 3001.5945 3998.3813 3001.5945 3998.3835 3001.5945 3998.3845 3001.5945 3998.3857 3001.5945 3998.3864 3001.5945 3998.3877 3001.5945 3998.3908 3001.5945 3998.3937 3001.5945 3998.3979 3001.5945 3998.3988 3001.5945 3998.3995 3001.5945 3998.4001 3001.5945 3998.4036 3001.5945 3998.4055 3001.5945 3998.4081 3001.5945 3998.409 3001.5945 3998.4103 3001.5945 3998.4109 3001.5945 3998.4128 3001.5945 3998.4138 3001.5945 3998.4141 3001.5945 3998.4164 3001.5945 3998.4231 3001.5945 3998.4246 3001.5945 3998.4275 3001.5945 3998.4301 3001.5945 3998.4304 3001.5945 3998.4317 3001.5945 3998.4345 3001.5945 3998.4371 3001.5945 3998.438 3001.5945 3998.4502 3001.5945 3998.4553 3001.5945 3998.46 3001.5945 3998.4607 3001.5945 3998.462 3001.5945 3998.4658 3001.5945 3998.4683 3001.5945 3998.4696 3001.5945 3998.4703 3001.5945 3998.475 3001.5945 3998.4763 3001.5945 3998.4795 3001.5945 3998.4801 3001.5945 3998.483 3001.5945 3998.4875 3001.5945 3998.4887 3001.5945 3998.4923 3001.5945 3998.497 3001.5945 3998.499 3001.5945 3998.5028 3001.5945 3998.5053 3001.5945 3998.5076 3001.5945 3998.5114 3001.5945 3998.5143 3001.5945 3998.5149 3001.5945 3998.5159 3001.5945 3998.5178 3001.5945 3998.5296 3001.5945 3998.5541 3001.5945 3998.5567 3001.5945 3998.5576 3001.5945 3998.5586 3001.5945 3998.5784 3001.5945 3998.5803 3001.5945 3998.5819 3001.5945 3998.5873 3001.5945 3998.5889 3001.5945 3998.5962 3001.5945 3998.5981 3001.5945 3998.6035 3001.5945 3998.6087 3001.5945 3998.6096 3001.5945 3998.6102 3001.5945 3998.6115 3001.5945 3998.6122 3001.5945 3998.6179 3001.5945 3998.6214 3001.5945 3998.6249 3001.5945 3998.6278 3001.5945 3998.6294 3001.5945 3998.6297 3001.5945 3998.6316 3001.5945 3998.6323 3001.5945 3998.6358 3001.5945 3998.6434 3001.5945 3998.6472 3001.5945 3998.6523 3001.5945 3998.6543 3001.5945 3998.6568 3001.5945 3998.6574 3001.5945 3998.668 3001.5945 3998.6944 3001.5945 3998.6999 3001.5945 3998.704 3001.5945 3998.7126 3001.5945 3998.7203 3001.5945 3998.7394 3001.5945 3998.748 3001.5945 3998.7496 3001.5945 3998.7512 3001.5945 3998.7518 3001.5945 3998.7531 3001.5945 3998.7547 3001.5945 3998.7636 3001.5945 3998.7649 3001.5945 3998.7828 3001.5945 3998.7907 3001.5945 3998.7917 3001.5945 3998.7927 3001.5945 3998.8092 3001.5945 3998.8143 3001.5945 3998.8156 3001.5945 3998.821 3001.5945 3998.823 3001.5945 3998.8303 3001.5945 3998.8319 3001.5945 3998.836 3001.5945 3998.8427 3001.5945 3998.844 3001.5945 3998.8456 3001.5945 3998.8462 3001.5945 3998.8517 3001.5945 3998.8555 3001.5945 3998.8587 3001.5945 3998.8619 3001.5945 3998.8638 3001.5945 3998.8654 3001.5945 3998.866 3001.5945 3998.8698 3001.5945 3998.8772 3001.5945 3998.8813 3001.5945 3998.8864 3001.5945 3998.8883 3001.5945 3998.8909 3001.5945 3998.8915 3001.5945 3998.8915 3001.5549 3998.8966 3001.5549 3998.9017 3001.5549 3998.9017 3001.5945 3998.9285 3001.5945 3998.9464 3001.5945 3998.954 3001.5945 3998.9732 3001.5945 3998.9821 3001.5945 3998.9837 3001.5945 3998.985 3001.5945 3998.9856 3001.5945 3998.9872 3001.5945 3998.9885 3001.5945 3998.9987 3001.5945 3999.0168 3001.5945 3999.0242 3001.5945 3999.0433 3001.5945 3999.0701 3001.5945 3999.0701 3001.5549 4001.1098 3001.5549 4002.1261 3001.5549 4002.1653 3001.5549 4002.5591 3001.5549 4003.1497 3001.5549 4003.189 3001.5549 4003.189 2998.4055 4003.1497 2998.4055 4002.5591 2998.4055 4002.1653 2998.4055 4002.1261 2998.4055 3997.8739 2998.4055 3997.8347 2998.4055 3997.4409 2998.4055 3996.8503 2998.4055 3996.811 2998.4055 3996.811 3001.5549 3996.8503 3001.5549 3997.0856 3001.5549 3997.0856 3001.5945 3997.0856 3001.5945\"}}]}"],"layers":["1~TopLayer~#FF0000~true~true~true~","2~BottomLayer~#0000FF~true~false~true~","3~TopSilkLayer~#FFCC00~true~false~true~","4~BottomSilkLayer~#66CC33~true~false~true~","5~TopPasteMaskLayer~#808080~true~false~true~","6~BottomPasteMaskLayer~#800000~true~false~true~","7~TopSolderMaskLayer~#800080~true~false~true~0.3","8~BottomSolderMaskLayer~#AA00FF~true~false~true~0.3","9~Ratlines~#6464FF~true~false~true~","10~BoardOutLine~#FF00FF~true~false~true~","11~Multi-Layer~#FFFFFF~true~false~true~0.5","12~Document~#FFFFFF~true~false~true~","13~TopAssembly~#33CC99~true~false~true~","14~BottomAssembly~#5555FF~true~false~true~","15~Mechanical~#F022F0~true~false~true~","19~3DModel~#66CCFF~true~false~true~","21~Inner1~#800000~false~false~false~~","22~Inner2~#008000~false~false~false~~","23~Inner3~#00FF00~false~false~false~~","24~Inner4~#BC8E00~false~false~false~~","25~Inner5~#70DBFA~false~false~false~~","26~Inner6~#00CC66~false~false~false~~","27~Inner7~#9966FF~false~false~false~~","28~Inner8~#800080~false~false~false~~","29~Inner9~#008080~false~false~false~~","30~Inner10~#15935F~false~false~false~~","31~Inner11~#000080~false~false~false~~","32~Inner12~#00B400~false~false~false~~","33~Inner13~#2E4756~false~false~false~~","34~Inner14~#99842F~false~false~false~~","35~Inner15~#FFFFAA~false~false~false~~","36~Inner16~#99842F~false~false~false~~","37~Inner17~#2E4756~false~false~false~~","38~Inner18~#3535FF~false~false~false~~","39~Inner19~#8000BC~false~false~false~~","40~Inner20~#43AE5F~false~false~false~~","41~Inner21~#C3ECCE~false~false~false~~","42~Inner22~#728978~false~false~false~~","43~Inner23~#39503F~false~false~false~~","44~Inner24~#0C715D~false~false~false~~","45~Inner25~#5A8A80~false~false~false~~","46~Inner26~#2B937E~false~false~false~~","47~Inner27~#23999D~false~false~false~~","48~Inner28~#45B4E3~false~false~false~~","49~Inner29~#215DA1~false~false~false~~","50~Inner30~#4564D7~false~false~false~~","51~Inner31~#6969E9~false~false~false~~","52~Inner32~#9069E9~false~false~false~~","99~ComponentShapeLayer~#00CCCC~true~false~true~","100~LeadShapeLayer~#CC9999~true~false~true~","101~ComponentPolarityLayer~#66FFCC~true~false~true~","Hole~Hole~#222222~false~false~true~","DRCError~DRCError~#FAD609~false~false~true~"],"objects":["All~true~false","Component~true~true","Prefix~true~true","Name~true~false","Track~true~true","Pad~true~true","Via~true~true","Hole~true~true","Copper_Area~true~true","Circle~true~true","Arc~true~true","Solid_Region~true~true","Text~true~true","Image~true~true","Rect~true~true","Dimension~true~true","Protractor~true~true"],"BBox":{"x":3994.5,"y":2997.4,"width":10.9,"height":5.2},"netColors":[]};

try {
  console.log('Parsing footprint...');
  const parsed = parseEasyEDAFootprint(JSON.stringify(footprintStr));

  console.log('Origin from head:', parsed.originX, parsed.originY);
  console.log('Number of pads:', parsed.pads.length);
  console.log('Number of lines:', parsed.lines.length);
  console.log('Number of solidRegions:', parsed.solidRegions.length);

  console.log('\nConverting to KiCad format...');
  const kicadFootprint = convertToKiCadFootprint(parsed, parsed.originX, parsed.originY);

  console.log('\nSaving to file...');
  fs.writeFileSync('/Users/dkkang/Downloads/our_R0603_C25804.kicad_mod', kicadFootprint);

  console.log('Done! File saved to /Users/dkkang/Downloads/our_R0603_C25804.kicad_mod');
} catch (error) {
  console.error('Error:', error);
  process.exit(1);
}
